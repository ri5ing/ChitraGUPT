{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the ChitraGupt application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "User's role (client, auditor, admin)."
        },
        "subscriptionPlan": {
          "type": "string",
          "description": "The user's current subscription plan."
        },
        "creditBalance": {
          "type": "number",
          "description": "The user's current credit balance."
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "subscriptionPlan",
        "creditBalance"
      ]
    },
    "AuditorProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AuditorProfile",
      "type": "object",
      "description": "Represents the public-facing profile of an auditor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the auditor (matches their UID)."
        },
        "displayName": {
          "type": "string",
          "description": "The auditor's display name."
        },
        "avatarUrl": {
          "type": "string",
          "description": "URL for the auditor's avatar image."
        },
        "firm": {
          "type": "string",
          "description": "The auditor's firm or if they are independent."
        },
        "specialization": {
          "type": "array",
          "description": "The auditor's areas of legal specialization.",
          "items": {
            "type": "string"
          }
        },
        "experience": {
          "type": "number",
          "description": "The auditor's years of experience."
        }
      },
      "required": ["id", "displayName", "avatarUrl"]
    },
    "Contract": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Contract",
      "type": "object",
      "description": "Represents a contract uploaded to the ChitraGupt application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the contract."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Contract)"
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time when the contract was uploaded.",
          "format": "date-time"
        },
        "documentName": {
          "type": "string",
          "description": "The file name of the uploaded contract."
        },
        "analysisReportId": {
          "type": "string",
          "description": "Reference to the AIAnalysisReport. (Relationship: Contract 1:1 AIAnalysisReport)"
        }
      },
      "required": [
        "id",
        "userId",
        "uploadDate",
        "documentName",
        "analysisReportId"
      ]
    },
    "AIAnalysisReport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AIAnalysisReport",
      "type": "object",
      "description": "Represents the AI analysis report generated for a contract.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI analysis report."
        },
        "summary": {
          "type": "string",
          "description": "Summary of the contract generated by AI."
        },
        "riskScore": {
          "type": "number",
          "description": "Risk score of the contract generated by AI."
        },
        "missingClauses": {
          "type": "array",
          "description": "List of missing clauses identified by AI.",
          "items": {
            "type": "string"
          }
        },
        "recommendations": {
          "type": "string",
          "description": "Recommendations generated by AI."
        }
      },
      "required": [
        "id",
        "summary",
        "riskScore",
        "missingClauses",
        "recommendations"
      ]
    },
    "AuditorFeedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AuditorFeedback",
      "type": "object",
      "description": "Represents feedback provided by an auditor on a contract.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the auditor feedback."
        },
        "contractId": {
          "type": "string",
          "description": "Reference to Contract. (Relationship: Contract 1:N AuditorFeedback)"
        },
        "auditorId": {
          "type": "string",
          "description": "Reference to UserProfile (Auditor). (Relationship: UserProfile 1:N AuditorFeedback)"
        },
        "feedbackText": {
          "type": "string",
          "description": "Textual feedback provided by the auditor."
        },
        "approvalStatus": {
          "type": "string",
          "description": "Approval status of the contract by the auditor (e.g., approved, rejected, needs revision)."
        },
        "annotationIds": {
          "type": "array",
          "description": "References to Annotations. (Relationship: Annotation 1:N AuditorFeedback)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "contractId",
        "auditorId",
        "feedbackText",
        "approvalStatus"
      ]
    },
    "Annotation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Annotation",
      "type": "object",
      "description": "Represents annotations on a contract by an auditor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the annotation."
        },
        "contractId": {
          "type": "string",
          "description": "Reference to Contract. (Relationship: Contract 1:N Annotation)"
        },
        "auditorId": {
          "type": "string",
          "description": "Reference to UserProfile (Auditor). (Relationship: UserProfile 1:N Annotation)"
        },
        "text": {
          "type": "string",
          "description": "The content of annotation."
        },
        "position": {
          "type": "string",
          "description": "The position of annotation in contract."
        }
      },
      "required": [
        "id",
        "contractId",
        "auditorId",
        "text",
        "position"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The userId is the Firebase Auth UID. This path enables path-based ownership for security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/auditors/{auditorId}",
        "definition": {
            "entityName": "AuditorProfile",
            "schema": {
                "$ref": "#/backend/entities/AuditorProfile"
            },
            "description": "Stores public-facing information for auditors. This collection can be read by any authenticated user, but only written to by the auditor themselves or an admin.",
            "params": [
                {
                    "name": "auditorId",
                    "description": "The Firebase Auth UID of the auditor."
                }
            ]
        }
      },
      {
        "path": "/users/{userId}/contracts/{contractId}",
        "definition": {
          "entityName": "Contract",
          "schema": {
            "$ref": "#/backend/entities/Contract"
          },
          "description": "Stores contracts uploaded by users. The userId parameter ensures that only the owner can access the contract (path-based ownership).",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who owns the contract."
            },
            {
              "name": "contractId",
              "description": "Unique identifier for the contract."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/contracts/{contractId}/analysisReports/{analysisReportId}",
        "definition": {
          "entityName": "AIAnalysisReport",
          "schema": {
            "$ref": "#/backend/entities/AIAnalysisReport"
          },
          "description": "Stores AI analysis reports for each contract. The structure maintains a clear hierarchy and ensures path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who owns the contract."
            },
            {
              "name": "contractId",
              "description": "Unique identifier for the contract."
            },
            {
              "name": "analysisReportId",
              "description": "Unique identifier for the AI analysis report."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/contracts/{contractId}/auditorFeedback/{auditorFeedbackId}",
        "definition": {
          "entityName": "AuditorFeedback",
          "schema": {
            "$ref": "#/backend/entities/AuditorFeedback"
          },
          "description": "Stores auditor feedback for each contract. The structure maintains a clear hierarchy and ensures that only authorized auditors can add feedback.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who owns the contract."
            },
            {
              "name": "contractId",
              "description": "Unique identifier for the contract."
            },
            {
              "name": "auditorFeedbackId",
              "description": "Unique identifier for the auditor feedback."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/contracts/{contractId}/annotations/{annotationId}",
        "definition": {
          "entityName": "Annotation",
          "schema": {
            "$ref": "#/backend/entities/Annotation"
          },
          "description": "Stores annotations made by auditors on specific contracts.  The structure ensures that annotations are directly linked to a contract and an auditor.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who owns the contract."
            },
            {
              "name": "contractId",
              "description": "Unique identifier for the contract."
            },
            {
              "name": "annotationId",
              "description": "Unique identifier for the annotation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure, scalable, and easily maintainable data model for the ChitraGupt application. It focuses on authorization independence and clear separation of concerns to simplify security rules and ensure data integrity. The structure adheres to the principle of path-based ownership for user-specific data, collaborative data, and segregation of data based on access control requirements. Specifically, it:\n\n*   Eliminates the need for `get()` calls in security rules by denormalizing authorization data, thus ensuring Authorization Independence.\n*   Segregates data based on access control needs, placing UserProfiles in their own collection and their associated Contracts into a subcollection. This allows us to use path-based rules for most operations.\n*   Enables secure `list` operations (QAPs) by ensuring that each collection contains documents with homogenous security requirements.\n\nThe data model includes collections for user profiles (`users`) and subcollections for user-owned contracts (`users/{userId}/contracts/{contractId}`). Analysis reports are stored as subcollections to maintain a clear hierarchy. Auditor feedback and annotations are stored as subcollections of contracts to maintain a logical data model. A public `auditors` collection is used to securely list auditor profiles without exposing sensitive user data."
  }
}

    